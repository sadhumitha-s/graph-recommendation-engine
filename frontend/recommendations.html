<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphRec - Results</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="container">
    <nav>
        <a href="index.html">Interact</a>
        <a href="recommendations.html" class="active">Recommendations</a>
    </nav>

    <div class="card">
        <h2>Target User</h2>
        <div class="control-group">
            <label>Get recommendations for User ID:</label>
            <input type="number" class="user-id-input" min="1">
            <button onclick="renderRecommendations()">Refresh</button>
        </div>
    </div>

    <div class="card">
        <h2>Live Recommendations</h2>
        <div id="results-area">
            <p style="color: #666;">Click Refresh to traverse the graph.</p>
        </div>
    </div>

    <div class="card">
        <h2>Engine Metrics</h2>
        <div id="metrics-area" class="metrics-bar">
            <span>Loading metrics...</span>
        </div>
    </div>
</div>

<script src="js/app.js"></script>
<script>
    async function renderRecommendations() {
        const container = document.getElementById('results-area');
        container.innerHTML = '<p>Traversing graph...</p>';

        const data = await fetchRecommendations();

        if (!data) {
            container.innerHTML = '<p style="color:red">Error contacting backend.</p>';
            return;
        }

        if (data.recommendations.length === 0) {
            container.innerHTML = `
                <div style="text-align:center; padding: 20px;">
                    <p>No recommendations found.</p>
                    <small>Go to the <strong>Interact</strong> page and like some items first!</small>
                </div>
            `;
        } else {
            const ul = document.createElement('ul');
            ul.className = 'rec-list';
            
            data.recommendations.forEach(item => {
                const li = document.createElement('li');
                li.className = 'rec-item';
                li.innerHTML = `
                    <div>
                        <strong>${item.title}</strong>
                        <span class="badge">${item.category}</span>
                    </div>
                    <div class="rec-score">Recommended</div>
                `;
                ul.appendChild(li);
            });
            
            container.innerHTML = '';
            container.appendChild(ul);
            
            // Add latency footer
            const meta = document.createElement('div');
            meta.style.marginTop = '15px';
            meta.style.fontSize = '0.8rem';
            meta.style.color = '#94a3b8';
            meta.innerText = `Computed in ${data.latency_ms.toFixed(4)} ms`;
            container.appendChild(meta);
        }
        
        // Refresh metrics too
        renderMetrics();
    }

    async function renderMetrics() {
        const metrics = await fetchMetrics();
        const area = document.getElementById('metrics-area');
        if (metrics) {
            area.innerHTML = `
                <span>Nodes: ${metrics.nodes_users + metrics.nodes_items}</span>
                <span>Edges: ${metrics.edges_interactions}</span>
            `;
        }
    }

    // Load on page open
    window.addEventListener('userChanged', renderRecommendations);
    renderMetrics();
</script>

</body>
</html>